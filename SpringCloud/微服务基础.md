关于这方面，有比较好的电子书《凤凰架构》：https://jingyecn.top:18080/

# 一些术语 

**服务**：操作系统上术语：一个程序，开发中术语：一个能对外提供功能的程序

**微服务**：小的服务，一个完整项目可以拆n个子项目，这些子项目能独立运行，独立对为提供功能。

**节点**：微观上：一个服务，宏观上：一台服务器

**垂直扩展**：垂直扩展是指增强单机硬件性能

**水平扩展**：通过增加更多的服务器或者程序实例来分散负载，从而提升存储能力和计算能力。

**容错率**：允许服务器集群错误(异常/故障)出现的范围和概率，

**高内聚低耦合**：内聚-->讲究程序功能独立   耦合--->讲究程序间交互，

**流量**：有很多种说法，开发中说的是访问量(请求次数)

**服务间依赖**：项目与项目间的调用，程序与程序间的调用

**资源调度**：各种资源进行合理有效的调节和测量及分析和使用，开发中资源：服务器，内存，CPU，IO等项目运行需要各种软硬件。

**单点**：开发中的单点：唯一一个mysql数据库，唯一个服务器

**单点故障**：如果项目/程序部署唯一一个服务器，它挂了，那就玩完了

**宕机**：服务器挂了

# 单体、分布式、集群

**单体**
一个系统业务量很小的时候，所有的代码都放在一个项目中，然后这个项目部署在一台服务器上就好了。
整个项目所有的服务都由这台服务器提供，这就是单机结构。

![image-20201027172014044](https://image.itbaima.net/images/253/image-20231001206174238.png)

单体应用开发简单，部署测试简单，但是存在一些问题
比如：单点问题，单机处理能力有限，当业务增长到一定程度的时候，单机的硬件资源将无法满足业务需求。。。

**分布式**
整个系统运行使用到Tomcat和MySQL，2G的内存需要分配给Tomcat和MySQL使用
由于单台服务器处理的能力有限，随着业务越来越复杂，请求越来越多. 内存越来越不够用。
这时候需要进行分布式的部署

![image-20201027173909529](https://image.itbaima.net/images/253/image-20231001206072377.png)

比如现在发起一个请求，这个请求需要依赖**分布**在两台不同的服务器的组件[ Tomat和MySQL]才能完成，叫做分布式系统

**集群**
上面的图解中存在一定问题：
比如Tomcat存在单点故障问题，一旦Tomcat所在的服务器宕机不可用了，系统就无法提供服务了

针对单点故障问题，使用集群来解决
把单机复制几份，构成一个“集群”，集群中每台服务器就叫做这个集群的一个“节点”，所有节点构成了一个集群。
每个节点都提供相同的服务，系统的处理能力相当于提升了好几倍

用户的请求由哪个节点来处理呢？
最好能够让此时此刻负载较小的节点来处理，这样使得每个节点的压力都比较平均。要实现这个功能，就需要在所有节点之前增加一个“调度者”的角色，用户的所有请求都先交给它，然后它根据当前所有节点的负载情况，决定将这个请求交给哪个节点处理。
这个“调度者”就是——负载均衡服务器。

![image-20201027182534219](https://image.itbaima.net/images/253/image-20231001204966140.png)

在上面的图中仅展示了Tomcat的集群，如果MySQL压力比较大的情况下，也是可以对MySQL进行集群的

# 系统架构演变

​随着互联网的发展，网站应用的规模也不断的扩大，进而导致系统架构也在不断的变化。

系统架构大体经历了下面几个过程:
**单体应用架构--->垂直应用架构--->分布式架构--->SOA架构--->微服务架构。**

## 单体应用架构

一般的网站应用流量较小，只需一个应用，将所有功能代码都部署在一起就可以，这样可以减少开发、部署和维护的成本。

**优点**

- 项目架构简单，开发成本低

- 项目部署在一个节点上， 维护方便

**缺点**

- 全部功能集成在一个工程中，对于大型项目来讲不易开发和维护

- 项目模块之间紧密耦合，单点容错率低

- 无法针对不同模块进行针对性优化和水平扩展

## 垂直应用架构

随着访问量的逐渐增大，单一应用只能依靠增加节点来应对，但是这时候会发现并不是所有的模块都会有比较大的访问量

以电商为例，用户访问量的增加可能影响的只是用户和订单模块，但是对消息模块的影响就比较小.
此时希望只多增加几个订单模块，而不增加消息模块，单体应用就做不到了，垂直应用应运而生

所谓的垂直应用架构，就是将原来的一个应用拆成互不相干的几个应用，以提升效率。
比如将电商的单体应用拆分成:

- 电商系统(用户管理 商品管理 订单管理)

- 后台系统(用户管理 订单管理 客户管理)

- CMS系统(广告管理 营销管理)

一旦用户访问量变大，只需要增加电商系统的节点就可以了，而无需增加后台和CMS的节点。

![image-20201028095743602](https://image.itbaima.net/images/253/image-20231001207570474.png)

**优点**

- 系统拆分实现了流量分担，解决了并发问题，而且可以针对不同模块进行优化和水平扩展

- 一个系统的问题不会影响到其他系统，提高容错率

**缺点**

- 系统之间相互独立，无法进行相互调用

- 系统之间相互独立，会有重复的开发任务

## 分布式架构

当垂直应用越来越多，重复的业务代码就会越来越多。

这时候，人们就开始思考可不可以将重复的代码抽取出来，做成统一的业务层作为独立的服务，然后由前端控制层调用不同的业务层服务呢？

这就产生了分布式系统架构。它把工程拆分成表现层和服务层两个部分。
服务层中包含业务逻辑，表现层只需要处理和页面的交互，业务逻辑都是调用服务层的服务来实现。

![image-20201028103739904](https://image.itbaima.net/images/253/image-2023100120747522.png)

**优点**

- 抽取公共的功能为服务层，提高代码复用性

**缺点**

- 系统间耦合度变高，调用关系错综复杂，难以维护

## SOA架构

分布式架构下，当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心对集群进行实时管理。
此时，用于资源调度和治理中心(SOA Service Oriented Architecture，面向服务的架构)是关键。

![SOA架构](https://image.itbaima.net/images/253/image-2023100120999613.jpeg)

**优点**

- 使用注册中心解决了服务间调用关系的自动调节

**缺点**

- 服务间会有依赖关系，一旦某个环节出错会影响较大( 服务雪崩 )

- 服务关系复杂，运维、测试部署困难

## 微服务架构

微服务架构在某种程度上是面向服务的架构SOA继续发展的下一步，它更加强调服务的"彻底拆分"。

![image-20201028110735067](https://image.itbaima.net/images/253/image-20231001203699757.png)

**优点**

- 服务原子化拆分，独立打包、部署和升级，保证每个微服务清晰的任务划分，利于扩展

- 微服务之间采用RESTful等轻量级Http协议相互调用

**缺点**

- 分布式系统开发的技术成本高（容错、分布式事务等）

# 微服务架构简介

微服务架构，简单的说就是将单体应用进一步拆分，拆分成更小的服务，每个服务都是一个可以独立运行的项目。

* 微服务把**一个庞大的单体应用拆分为一个个的小型服务**。以图书管理项目为例，有登录、注册、添加、删除、搜索等功能，那么可以将这些功能单独做成一个个小型的SpringBoot项目，独立运行。
* **每个小型的微服务，都可以独立部署和升级**。这样，就算整个系统崩溃，那么也只会影响一个服务的运行。
* **微服务之间使用HTTP进行数据交互**，不再是单体应用内部交互了。虽然这样会显得更麻烦，但是带来的好处也是很直接的，甚至能**突破语言限制**，使用不同的编程语言进行微服务开发，只需要使用HTTP进行数据交互即可。
* **可以用多台主机来分别部署这些微服务**。这样，单机的压力就被分散到多台机器，并且每台机器的配置不一定需要太高，这节省大量的成本，同时安全性也得到很大的保证。
* 甚至**同一个微服务可以同时存在多个**。这样当其中一个服务器出现问题时，其他服务器也在运行同样的微服务，这样就可以保证一个微服务的高可用。

**微服务架构的常见问题**
- 这么多小服务，如何管理他们？

- 这么多小服务，他们之间如何通讯？

- 这么多小服务，客户端怎么访问他们？

- 这么多小服务，一旦出现问题了，应该如何自处理？

- 这么多小服务，一旦出现问题了，应该如何排错?

- 在分布式的环境下，单体应用的某些功能可能会变得比较麻烦，比如分布式事务

大部分的微服务产品都针对每一个问题提供了相应的组件来解决它们

![微服务架构](https://image.itbaima.net/images/253/image-2023100120432337.jpeg)

# 从SpringCloud看微服务架构

Spring Cloud并没有重复制造轮子，它只是将目前各家公司开发的比较成熟、经得起实际考验的服务框架组合起来，通过Spring Boot风格进行再封装，屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包。

**SpringBoot和SpringCloud**
SpringBoot专注于快速方便的开发单个个体微服务。
SpringCloud关注全局的微服务协调整理治理，它将SpringBoot开发的一个个单体微服务整合并管理起来，为各个微服务之间提供，配置管理、服务发现、断路器、路由、事件总线、分布式事务、等等集成服务。

**SpringCloud版本名称**
因为Spring Cloud不同其他独立项目，它是拥有很多子项目的大项目。所以它的版本是 `版本名+版本号`
比如：Greenwich.SR6
* 版本名：伦敦的地铁名 
* 版本号：SR（Service Releases）是固定的，大概意思是稳定版本。后面会有一个递增的数字。 

所以 Greenwich.SR6就是Greenwich的第6个Release版本。

**SpringCloud整体架构**
SpringCloud在分布式架构下的各个场景，都有对应的组件来处理
**基于Netflix**的开源分布式解决方案提供的组件：

- Eureka  -  实现服务治理（**服务注册与发现**）。可以对所有的微服务进行集中管理，包括它们的运行状态、信息等。
- Ribbon  -  为服务之间相互调用**提供负载均衡算法**（现在被SpringCloudLoadBalancer取代）
- Hystrix  -  断路器，保护系统，控制故障范围。可以跟家里电闸的保险丝类比，当触电危险发生时能够防止进一步的发展。
- Zuul   -     api网关，路由，负载均衡等多种作用。就像路由器，可能有很多个设备都连接了路由器，但是数据包要转发给谁则是由路由器在进行（已经被SpringCloudGateway取代）
- Config  -  配置管理，可以实现配置文件集中管理

**为什么倾向于使用SpringCloud Alibaba**
SpringCloud Netflix的组件：服务注册与发现的 Eureka、服务限流降级的 Hystrix、网关 Zuul都已经停止更新了，出现问题，官方不维护，需要自行解决
